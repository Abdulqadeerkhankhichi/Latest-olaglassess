@using Olaglasses.Models;
@model Olaglasses.Models.tblUserPrescription
@{
    ViewBag.Title = "Create";
    Layout = "~/Views/Shared/_DashboardLayout.cshtml";
}
<head>
    <style>

        video {
            width: 100% !important;
            border-radius: 20px !important
        }

        video {
            -webkit-transform: scaleX(-1);
            transform: scaleX(-1);
        }
    </style>
</head>


<div class="row">
    <div class="col-md-5 col-5">
        <div class="breadcrumb-bar">
            <div class="container-fluid">
                <div class="row align-items-center">
                    @*@if (Model.PrescriptionID > 0)
                        {
                            <h2 class="breadcrumb-title">Edit Prescription Info</h2>
                        }
                        else
                        {
                            <h2 class="breadcrumb-title">Add Prescription Info</h2>
                        }*@
                    <h2 class="breadcrumb-title">View Prescription Info</h2>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-4 col-4"></div>
    <div class="col-md-3 col-3 ">

        <a href="@Url.Action("Index","Prescription", new { id=@ViewBag.UserID})" class="btn btn-secondary float-right" style="background-color:var(--Secondery-color); color:white ;float: right;"><i class="fa fa-list"></i> Prescription List</a>

    </div>
</div>



<div class="doc-review review-listing custom-edit-service">




    <!-- Add Blog -->
    <div class="card">
        <div class="card-body">
            @using (Html.BeginForm("Create", "Prescription", FormMethod.Post, new
            {
                enctype = "multipart/form-data"
            }))
            {
                <form>
                    <input name="pdimage" id="pdimage" value="" hidden />
                    <input type="hidden" name="PrescriptionID" value="@Model.PrescriptionID">
                    <input type="hidden" name="UserID" value="@Model.UserID">
                    <div class="service-fields">

                        <div class="row" style="display:none">
                            <div class="col-md-4">
                                <div class="form-group">
                                    <div class="change-avatar">
                                        <div class="profile-img">
                                            <img src=@Model.PrescriptionImage alt="User Image" id="PrescriptionImage">
                                            <input type="text" name="PrescriptionImage" value="@Model.PrescriptionImage" hidden>
                                        </div>
                                        <div class="upload-img">
                                            <div class="change-photo-btn" style="width:203px">
                                                <span><i class="fa fa-upload"></i> Upload Prescription Photo</span>
                                                <input type="file" class="upload" id="Image" name="Image" onchange="show(this)">
                                            </div>

                                        </div>
                                    </div>
                                </div>


                            </div>
                            <div class="col-md-5">
                                <div class="form-group">
                                    <div class="change-avatar">
                                        <div class="profile-img">

                                            <img src=@Model.PDImage alt="User Image" id="pdImage">
                                            @*<input type="text" name="PrescriptionImage" value="@Model.PDImage" hidden>*@
                                        </div>
                                        <div class="upload-img" onclick="opencameramodal()">
                                            <div class="change-photo-btn" style="background-color: #FFAC00">
                                                <span><i class="fa fa-upload"></i> Upload PD Photo </span>

                                            </div>

                                        </div>
                                    </div>
                                </div>


                            </div>
                        </div>



                        <div class="row">
                            <div class="col-lg-2">
                                <div class="form-group" style="margin-top: 25%;">
                                    <h5>Left Eye</h5>


                                </div>
                            </div>
                            <div class="col-lg-2">
                                <div class="form-group">
                                    <label>SPH</label>
                                    @*<select class="form-control select" name="l_sph">
                                            @foreach (var item in ViewBag.SPH)
                                            {
                                                if (Model.l_sph == Convert.ToDouble(item.TypeValue))
                                                {
                                                    <option selected>@item.TypeValue</option>
                                                }
                                                else
                                                {
                                                    <option> @item.TypeValue</option>
                                                }

                                            }
                                        </select>*@
                                    <input disabled value="@Model.l_sph" class="form-control" type="text" />

                                </div>
                            </div>
                            <div class="col-lg-2">
                                <label>CYL</label>
                                @*<div class="form-group">

                                        <select class="form-control select" name="l_cyl">
                                            @foreach (var item in ViewBag.CYL)
                                            {
                                                if (Model.l_cyl == Convert.ToDouble(item.TypeValue))
                                                {
                                                    <option selected>@item.TypeValue</option>
                                                }
                                                else
                                                {
                                                    <option> @item.TypeValue</option>
                                                }

                                            }
                                        </select>
                                    </div>*@
                                <input disabled value="@Model.l_cyl" class="form-control" type="text" />
                            </div>
                            <div class="col-lg-2">
                                <div class="form-group">
                                    <label>AXIS</label>

                                    <input disabled class="form-control" type="text" name="l_axis" id="l_axis" value="@Model.l_axis">
                                </div>
                            </div>
                            <div class="col-lg-2">
                                <div class="form-group">
                                    <label>ADD</label>
                                    @*<select class="form-control select" name="l_add">
                                            @foreach (var item in ViewBag.ADD)
                                            {
                                                if (Model.l_add == Convert.ToDouble(item.TypeValue))
                                                {
                                                    <option selected>@item.TypeValue</option>
                                                }
                                                else
                                                {
                                                    <option> @item.TypeValue</option>
                                                }

                                            }
                                        </select>*@
                                    <input disabled class="form-control" type="text" name="l_axis" id="l_axis" value="@Model.l_add">

                                </div>
                            </div>

                        </div>
                        <div class="row">
                            <div class="col-lg-2">
                                <div class="form-group" style="margin-top: 25%;">
                                    <h5>Right Eye</h5>


                                </div>
                            </div>
                            <div class="col-lg-2">
                                <div class="form-group">
                                    <label>SPH</label>
                                    @*<select class="form-control select" name="r_sph">
                                            @foreach (var item in ViewBag.SPH)
                                            {
                                                if (Model.r_sph == Convert.ToDouble(item.TypeValue))
                                                {
                                                    <option selected>@item.TypeValue</option>
                                                }
                                                else
                                                {
                                                    <option> @item.TypeValue</option>
                                                }

                                            }
                                        </select>*@

                                    <input disabled class="form-control" type="text" name="l_axis" id="l_axis" value="@Model.r_sph" />

                                </div>
                            </div>
                            <div class="col-lg-2">
                                <div class="form-group">
                                    <label>CYL</label>
                                    @*<select class="form-control select" name="r_cyl">
                                            @foreach (var item in ViewBag.CYL)
                                            {
                                                if (Model.r_cyl == Convert.ToDouble(item.TypeValue))
                                                {
                                                    <option selected>@item.TypeValue</option>
                                                }
                                                else
                                                {
                                                    <option> @item.TypeValue</option>
                                                }

                                            }
                                        </select>*@

                                    <input disabled class="form-control" type="text" name="l_axis" id="l_axis" value="@Model.r_cyl" />
                                </div>
                            </div>
                            <div class="col-lg-2">
                                <div class="form-group">
                                    <label>AXIS</label>

                                    <input disabled class="form-control" type="text" name="l_axis" id="l_axis" value="@Model.r_axis">
                                </div>
                            </div>
                            <div class="col-lg-2">
                                <div class="form-group">
                                    <label>ADD</label>
                                    @*<select class="form-control select" name="r_add">
                                            @foreach (var item in ViewBag.ADD)
                                            {
                                                if (Model.r_add == Convert.ToDouble(item.TypeValue))
                                                {
                                                    <option selected>@item.TypeValue</option>
                                                }
                                                else
                                                {
                                                    <option> @item.TypeValue</option>
                                                }

                                            }
                                        </select>*@

                                    <input disabled class="form-control" type="text" name="l_axis" id="l_axis" value="@Model.r_add" />
                                </div>
                            </div>

                        </div>
                    </div>


                    <div class="service-fields">
                        <div class="row">
                            <div class="col-lg-2">
                                <div class="form-group" style="margin-top: 25%;">
                                    <h5>Pupillary Distance (PD) </h5>


                                </div>
                            </div>
                            <div class="col-lg-2">
                                <div class="form-group">
                                    <label>PD</label>

                                    @*<select class="form-control select" name="PD">
                                            @foreach (var item in ViewBag.PD)
                                            {
                                                if (Model.PD == Convert.ToDouble(item.TypeValue))
                                                {
                                                    <option selected>@item.TypeValue</option>
                                                }
                                                else
                                                {
                                                    <option> @item.TypeValue</option>
                                                }

                                            }
                                        </select>*@

                                    <input disabled class="form-control" type="text" name="l_axis" id="l_axis" value="@Model.PD" />
                                </div>
                            </div>

                        </div>
                        <div class="row">
                            <div class="col-lg-2">
                                <div class="form-group" style="margin-top: 25%;">
                                    <h5>Who is the prescription for?</h5>


                                </div>
                            </div>
                            <div class="col-lg-2">
                                <div class="form-group">
                                    <label>First Name<span class="text-danger">*</span></label>

                                    <input disabled class="form-control" type="text" name="Fname" id="Fname" value="@Model.Fname" required="">
                                </div>
                            </div>
                            <div class="col-lg-2">
                                <div class="form-group">
                                    <label>Last Name<span class="text-danger">*</span></label>

                                    <input disabled class="form-control" type="text" name="Lname" id="Lname" value="@Model.Lname" required="">
                                </div>
                            </div>
                            @*<div class="col-lg-2">
                                    <div class="form-group">
                                        <label>Save Prescription</label>

                                        <select class="form-control select" name="prescription">

                                            @if (Model.prescription == "Yes")
                                            {
                                                <option selected>Yes</option>
                                                <option>No</option>

                                            }
                                            @if (Model.prescription == "No")
                                            {
                                                <option>Yes</option>
                                                <option selected>No</option>
                                            }
                                            else
                                            {
                                                <option selected>Yes</option>
                                                <option>No</option>
                                            }

                                        </select>
                                    </div>
                                </div>*@
                            <div class="col-lg-2">
                                <div class="form-group">
                                    <label>Date of Prescription<span class="text-danger">*</span></label>

                                    @if (@Model.prescriptionDate != null)
                                    {
                                        <input disabled class="form-control" type="date" name="prescriptionDate" id="prescriptionDate" value="@Model.prescriptionDate.Value.ToString("yyyy-MM-dd")" required="">
                                    }
                                    else
                                    {
                                        <input disabled class="form-control" type="date" name="prescriptionDate" id="prescriptionDate" value="" required="">
                                    }

                                </div>
                            </div>


                            @*<div class="col-md-4" style="margin-top:3%">
                                <button class="btn btn-primary submit-btn" type="submit" name="form_submit" value="submit">Submit</button>
                                <a href="@Url.Action("Index","Prescription",new { id=@Model.UserID})"><button class="btn btn-secondary submit-btn" type="button" name="form_submit" value="submit">Cancel</button></a>
                            </div>*@
                        </div>
                    </div>

                </form>
            }
        </div>
    </div>
    <!-- /Add Blog -->

</div>

<script src="~/assets/js/jquery-3.2.1.min.js"></script>
<script src="~/assets/Twillio/twilio-video.min.js"></script>
<script type="text/javascript">


    document.addEventListener("click", function (evt) {
        var flyoutElement = document.getElementById('adminportalcameramodalcontent'),
            targetElement = evt.target;  // clicked element

        do {
            if (targetElement == flyoutElement) {

                return;
            }
            // Go up the DOM
            targetElement = targetElement.parentNode;
        } while (targetElement);

        /*alert("Clicked outside!");*/
        /*document.getElementById('ImagePDPath').src = "/assets/img/placeholder.jpg";*/
        const video = document.querySelector('video');

        // A video's MediaStream object is available through its srcObject attribute
        const mediaStream = video.srcObject;

        // Through the MediaStream, you can get the MediaStreamTracks with getTracks():
        const tracks = mediaStream.getTracks();

        // Tracks are returned as an array, so if you know you only have one, you can stop it with:
        tracks[0].stop();
    });

    function Submit() {
        $("#adminportalvideocameramodal").modal("hide");
        const video = document.querySelector('video');

        // A video's MediaStream object is available through its srcObject attribute
        const mediaStream = video.srcObject;

        // Through the MediaStream, you can get the MediaStreamTracks with getTracks():
        const tracks = mediaStream.getTracks();

        // Tracks are returned as an array, so if you know you only have one, you can stop it with:
        tracks[0].stop();

    }

    function Retake() {

        $("#admin-portal-video-camera-section").fadeIn();
        $("#Uadminportal-ploaded-Image-Section").fadeOut();

        document.getElementById('pdImage').src = "/assets/img/placeholder.jpg";
    }
    function CaptureImage() {
        var context = canvas.getContext('2d');
        width = 320;
        height = width / (4 / 3);
        if (width && height) {
            canvas.width = width;
            canvas.height = height;

            context.translate(width, 0);
            context.scale(-1, 1);

            context.drawImage(video, 0, 0, width, height);

            var data = canvas.toDataURL('image/png');
            img = document.getElementById('admin-portal-uploaded-image');
            img.src = data;
            img.classList.remove('hide');


            document.getElementById('admin-portal-uploaded-image').src = data;

            document.getElementById('pdImage').src = data;
            data = data.replace(/^data:image\/(png|jpg);base64,/, "");
            $("#pdimage").val(data);
        }

        $("#admin-portal-video-camera-section").fadeOut();
        $("#adminportal-Uploaded-Image-Section").fadeIn();


    }
    function closevideocamera() {
        $("#adminportalvideocameramodal").modal("hide");
        /*$("#cameramodal").modal("show");*/

        const video = document.querySelector('video');

        // A video's MediaStream object is available through its srcObject attribute
        const mediaStream = video.srcObject;

        // Through the MediaStream, you can get the MediaStreamTracks with getTracks():
        const tracks = mediaStream.getTracks();

        // Tracks are returned as an array, so if you know you only have one, you can stop it with:
        tracks[0].stop();
    }
    function opencameramodal() {
        $("#adminportalcameramodal").modal("show");
    }

    function opencamera() {
        $("#adminportalcameramodal").modal("hide");
        $("#adminportalvideocameramodal").modal("show");

        $("#adminportal-Uploaded-Image-Section").fadeOut();
        $("#admin-portal-video-camera-section").fadeIn();
        startVideo();


    }
    const container = document.getElementById("admin-video-div");
    async function startVideo() {
        $("#admin-video-div video").remove();
        const track = await Twilio.Video.createLocalVideoTrack();
        container.append(track.attach());
        video = document.getElementsByTagName("video")[0];


    }
    function show(input) {
        if (input.files && input.files[0]) {
            var filerdr = new FileReader();
            filerdr.onload = function (e) {
                $('#PrescriptionImage').attr('src', e.target.result);

            }
            filerdr.readAsDataURL(input.files[0]);
        }
    }
</script>
<script>

    $(document).ready(function () {
        $(".nav li").removeClass("active");
        $('#perscription').addClass('active');

    });
</script>


